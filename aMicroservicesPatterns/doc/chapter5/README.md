# 微服务架构中的业务逻辑设计 

使用[领域驱动设计](https://github.com/shanwenhao1/gin-web/blob/master/doc/DDD.md) 的聚合模式来设计业务逻辑.
聚合可以起到以下两个重要的作用:
- 使用聚合可以避免任何跨服务边界的对象引用, 因为聚合之间通过主键进行引用, 而不是通过对象的地址进行引用
- 由于单个事务只能创建或更新单个聚合, 因此聚合满足微服务事务模型的约束


## 聚合的规则
- 规则一: 只引用[聚合根](https://www.cnblogs.com/Gyoung/archive/2013/03/27/2984671.html). 
要求聚合根是聚合中唯一可以由外部类引用的部分, 客户只能通过聚合根上的方法来更新聚合.
- 规则二: 聚合间的引用必须使用主键. 引用聚合必须通过标识(例如: 主键)而不是对象引用, 使聚合之间松耦合
- 规则三: 在一个事务中, 只能创建或更新一个聚合. 该约束会使得创建或更新多个聚合的操作变得更加复杂, 但是符合
[Saga](../chapter4/README.md)的思想(每一步(事务)只创建或更新一个聚合)

## 聚合的颗粒度